<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" pageEncoding="UTF-8">
    <title>Editar Cliente</title>

    <!-- Bootstrap CSS -->
  	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  	<!-- Bootstrap JS -->
  	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

    <!-- Carga de estilos CSS personalizados -->
    <link href="/Styles/MenuStyle.css" rel="stylesheet">
    <link href="/Styles/WindowStyle.css" rel="stylesheet">
    <link href="/Styles/InsertarClienteStyle.css" rel="stylesheet">
    <link href="/Styles/ButtonStyle.css" rel="stylesheet">
    <link href="/Styles/TableStyle.css" rel="stylesheet">
    <link href="/Styles/InputStyle.css" rel="stylesheet">

    <!-- Carga de scripts JS personalizados -->
    <script src="/Scripts/InputScript.js"></script>
    <script src="/Scripts/MenuScript.js"></script>
    <script src="/Scripts/ModalAndToastScript.js"></script>
    <script src="/Scripts/InsertarClienteScript.js"></script>

    <!-- Carga de JQuery desde CDN -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>

<body>
    <!-- Cabecera de la página (incluye el menú) -->
    <div th:insert="Components/Menu :: Menu-Header" class="Header-container"></div>

    <!-- Contenedor principal -->
    <div class="Main-container">
        <!-- Barra lateral del menú -->
        <div th:insert="Components/Menu :: Menu-Sidebar" id="Menu-container" class="Menu-container"></div>

        <!-- Cuerpo principal -->
        <div class="Body-container overflow-y-auto">
            <!-- Formulario para editar los datos del cliente -->
            <form th:action="@{/Clientes/ActualizarCliente/{id}(id=${ClienteEditar.id})}" th:object="${ClienteEditar}" method="post" id="FormCliente" onsubmit="return ValidarFormulario()">
                <h3 class="mb-5 lead fw-bold text-center fs-4">EDITAR CLIENTE</h3>

                <div class="Form-container">
                    <!-- Sección de datos del cliente -->
                    <div class="BoxShadowContainer">
                        <h5 class="border-bottom border-2 pb-3 mb-4 bg-dark text-white py-4 text-center fw-bold">Datos del cliente</h5>
                        <div class="ms-3 px-4">
                            <!-- Campo DNI -->
                            <div class="mb-2">
                                <label for="InputDniCliente" class="form-label fw-bold fs-6 mb-0">DNI</label>
                                <input type="text" class="form-control" th:field="*{dni}" id="InputDniCliente" placeholder="Insertar DNI 12345678">
                            </div>
                            <!-- Campo Nombre -->
                            <div class="mb-2">
                                <label for="InputNombreCliente" class="form-label fw-bold fs-6 mb-0">Nombres</label>
                                <input type="text" class="form-control" th:field="*{nombre}" id="InputNombreCliente" placeholder="Insertar nombres">
                            </div>
                            <!-- Campo Apellido -->
                            <div class="mb-2">
                                <label for="InputApellidoCliente" class="form-label fw-bold fs-6 mb-0">Apellidos</label>
                                <input type="text" class="form-control" th:field="*{apellido}" id="InputApellidoCliente" placeholder="Insertar apellidos">
                            </div>
                            <!-- Campo Correo -->
                            <div class="mb-2">
                                <label for="InputCorreoCliente" class="form-label fw-bold fs-6 mb-0">Correo</label>
                                <input type="text" class="form-control" th:field="*{correo}" id="InputCorreoCliente" placeholder="Insertar correo">
                            </div>
                            <!-- Campo Teléfono -->
                            <div class="mb-2">
                                <label for="InputTelefonoCliente" class="form-label fw-bold fs-6 mb-0">Teléfono</label>
                                <input type="text" class="form-control" th:field="*{telefono}" id="InputTelefonoCliente" placeholder="Insertar teléfono">
                            </div>
                        </div>
                    </div>

                    <!-- Sección de ubicación del cliente -->
                    <div class="BoxShadowContainer">
                        <h5 class="border-bottom border-2 pb-3 mb-4 bg-dark text-white py-4 text-center fw-bold">Ubicación</h5>
                        <div class="ms-3 px-4">
                            <!-- Campos ocultos para la ubicación -->
                            <input type="hidden" id="idDepartamentoSeleccionado" th:value="${ClienteEditar.id_departamento}" />
                            <input type="hidden" id="idProvinciaSeleccionado" th:value="${ClienteEditar.id_provincia}" />
                            <input type="hidden" id="idDistritoSeleccionado" th:value="${ClienteEditar.id_distrito}" />

                            <!-- Select para Departamento -->
                            <label for="departamentosSelect" class="form-label fw-bold fs-6">Departamentos</label>
                            <select id="departamentosSelect" class="form-select" th:field="*{id_departamento}">
                                <option disabled selected value="">Seleccione una opción...</option>
                            </select>

                            <!-- Select para Provincia -->
                            <label for="provinciasSelect" class="form-label fw-bold fs-6">Provincia</label>
                            <select id="provinciasSelect" class="form-select" th:field="*{id_provincia}">
                                <option disabled selected value="">Seleccione una opción...</option>
                            </select>

                            <!-- Select para Distrito -->
                            <label for="distritosSelect" class="form-label fw-bold fs-6">Distrito</label>
                            <select id="distritosSelect" class="form-select" th:field="*{id_distrito}">
                                <option disabled selected value="">Seleccione una opción...</option>
                            </select>

                            <!-- Campo Dirección -->
                            <div class="mb-3">
                                <label for="InputDireccionCliente" class="form-label fw-bold fs-6 mb-0">Dirección del cliente</label>
                                <input type="text" class="form-control" id="InputDireccionCliente" th:field="*{direccion}" placeholder="Insertar dirección">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="d-flex justify-content-end gap-3 mt-4">
                    <a class="btn btn-outline-primary py-2 px-4 rounded-pill" type="button" th:href="@{/Clientes/ListaClientes}">Cancelar</a>
                    <button type="submit" class="btn btn-primary py-2 px-5 rounded-pill">Guardar cambios</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Mensajes de error o éxito -->
    <div th:insert="Components/ModalAndToast :: Toast-MessageDanger"></div>

    <script>
        // Función para verificar los campos del formulario antes de enviarlo
        function ValidarFormulario() {
            const dni = document.getElementById('InputDniCliente').value.trim();
            const nombre = document.getElementById('InputNombreCliente').value.trim();
            const apellido = document.getElementById('InputApellidoCliente').value.trim();
            const correo = document.getElementById('InputCorreoCliente').value.trim();
            const telefono = document.getElementById('InputTelefonoCliente').value.trim();
            const departamento = document.getElementById('departamentosSelect').value;
            const provincia = document.getElementById('provinciasSelect').value;
            const distrito = document.getElementById('distritosSelect').value;
            const direccion = document.getElementById('InputDireccionCliente').value.trim();

            if (!dni) {
                showToastMessage('Por favor, ingrese el DNI del cliente.');
                return false;
            }
            if (!nombre) {
                showToastMessage('Por favor, ingrese el nombre del cliente.');
                return false;
            }
            if (!apellido) {
                showToastMessage('Por favor, ingrese el apellido del cliente.');
                return false;
            }
            if (!correo) {
                showToastMessage('Por favor, ingrese el correo del cliente.');
                return false;
            }
            if (!telefono) {
                showToastMessage('Por favor, ingrese el teléfono del cliente.');
                return false;
            }
            if (!departamento) {
                showToastMessage('Por favor, seleccione un departamento.');
                return false;
            }
            if (!provincia) {
                showToastMessage('Por favor, seleccione una provincia.');
                return false;
            }
            if (!distrito) {
                showToastMessage('Por favor, seleccione un distrito.');
                return false;
            }
            if (!direccion) {
                showToastMessage('Por favor, ingrese la dirección del cliente.');
                return false;
            }
            return true;
        }
        setActiveByIndex(0);
    </script>

    <script>
        $(document).ready(function () {
            // Cargar los departamentos desde el servidor
            $.get('/Ubicaciones/getDepartamentos', function (data) {
                const departamentosSelect = $('#departamentosSelect');
                departamentosSelect.empty();
                departamentosSelect.append('<option disabled selected value="">Seleccione una opción...</option>');

                // Rellenar los departamentos en el selector
                data.forEach(function (departamento) {
                    departamentosSelect.append(`<option value="${departamento.id}">${departamento.name}</option>`);
                });

                // Seleccionar el departamento previamente seleccionado
                const idDepartamentoSeleccionado = $('#idDepartamentoSeleccionado').val();
                if (idDepartamentoSeleccionado) {
                    departamentosSelect.val(idDepartamentoSeleccionado).change();

                    // Cargar las provincias correspondientes
                    $.get('/Ubicaciones/getProvincias', { ID: idDepartamentoSeleccionado }, function (provinciasData) {
                        const provinciasSelect = $('#provinciasSelect');
                        provinciasSelect.empty();
                        provinciasSelect.append('<option disabled selected value="">Seleccione una opción...</option>');

                        // Rellenar las provincias
                        provinciasData.forEach(function (provincia) {
                            provinciasSelect.append(`<option value="${provincia.id}">${provincia.name}</option>`);
                        });

                        // Seleccionar la provincia previamente seleccionada
                        const idProvinciaSeleccionada = $('#idProvinciaSeleccionado').val();
                        if (idProvinciaSeleccionada) {
                            provinciasSelect.val(idProvinciaSeleccionada).change();

                            // Cargar los distritos correspondientes
                            $.get('/Ubicaciones/getDistritos', { ID: idProvinciaSeleccionada }, function (distritosData) {
                                const distritosSelect = $('#distritosSelect');
                                distritosSelect.empty();
                                distritosSelect.append('<option disabled selected value="">Seleccione una opción...</option>');

                                // Rellenar los distritos
                                distritosData.forEach(function (distrito) {
                                    distritosSelect.append(`<option value="${distrito.id}">${distrito.name}</option>`);
                                });

                                // Seleccionar el distrito previamente seleccionado
                                const idDistritoSeleccionado = $('#idDistritoSeleccionado').val();
                                if (idDistritoSeleccionado) {
                                    distritosSelect.val(idDistritoSeleccionado);
                                }
                            }).fail(function () {
                                alert('Error al cargar los distritos.');
                            });
                        }
                    }).fail(function () {
                        alert('Error al cargar las provincias.');
                    });
                }
            }).fail(function () {
                alert('Error al cargar los departamentos.');
            });

            // Actualizar las provincias al seleccionar un departamento
            $('#departamentosSelect').change(function () {
                const departamentoId = $(this).val();

                if (departamentoId) {
                    $.get('/Ubicaciones/getProvincias', { ID: departamentoId }, function (data) {
                        const provinciasSelect = $('#provinciasSelect');
                        provinciasSelect.empty();
                        provinciasSelect.append('<option disabled selected value="">Seleccione una opción...</option>');
                        data.forEach(function (provincia) {
                            provinciasSelect.append(`<option value="${provincia.id}">${provincia.name}</option>`);
                        });

                        // Reiniciar los distritos
                        $('#distritosSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
                    }).fail(function () {
                        alert('Error al cargar las provincias.');
                    });
                } else {
                    // Limpiar provincias y distritos si no hay selección
                    $('#provinciasSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
                    $('#distritosSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
                }
            });

            // Actualizar los distritos al seleccionar una provincia
            $('#provinciasSelect').change(function () {
                const provinciaId = $(this).val();

                if (provinciaId) {
                    $.get('/Ubicaciones/getDistritos', { ID: provinciaId }, function (data) {
                        const distritosSelect = $('#distritosSelect');
                        distritosSelect.empty();
                        distritosSelect.append('<option disabled selected value="">Seleccione una opción...</option>');
                        data.forEach(function (distrito) {
                            distritosSelect.append(`<option value="${distrito.id}">${distrito.name}</option>`);
                        });
                    }).fail(function () {
                        alert('Error al cargar los distritos.');
                    });
                } else {
                    // Limpiar distritos si no hay selección
                    $('#distritosSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
                }
            });
        });
    </script>

</body>

</html>

