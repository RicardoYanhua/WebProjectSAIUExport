<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8" pageEncoding="UTF-8">
<title>Insert title here</title>

<!-- Bootstrap -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
	crossorigin="anonymous">
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
	crossorigin="anonymous">
    </script>

<!-- Estilos -->
<link href="/Styles/MenuStyle.css" rel="stylesheet">
<link href="/Styles/InsertarClienteStyle.css" rel="stylesheet">
<link href="/Styles/ButtonStyle.css" rel="stylesheet">
<link href="/Styles/TableStyle.css" rel="stylesheet">
<link href="/Styles/InputStyle.css" rel="stylesheet">

<!-- Scripts -->
<script src="/Scripts/InputScript.js"></script>
<script src="/Scripts/MenuScript.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>

<body>
	<!-- Header -->
	<div th:insert="Components/Menu :: Menu-Header"
		class="Header-container"></div>

	<!-- Main Container -->
	<div class="Main-container">
		<!-- Sidebar -->
		<div th:insert="Components/Menu :: Menu-Sidebar" id="Menu-container"
			class="Menu-container"></div>

		<!-- Body -->
		<div class="Body-container overflow-y-auto">
			<form th:action="@{/Dashboard/Clientes/ActualizarCliente/{id}(id=${ClienteEditar.id})}"
				th:object="${ClienteEditar}" method="post" id="FormCliente">
				<h3 class="mb-5 lead fw-bold text-center fs-4">EDITAR CLIENTE</h3>

				<div class="Form-container">
				
					<!-- Datos del Cliente -->
					<div>
						<h5 class="border-bottom border-2 pb-2 mb-3 text-center fw-bold">Datos
							del cliente</h5>
						<div class="ms-3 px-4">
							<div class="mb-2">
								<label for="InputDniCliente"
									class="form-label fw-bold fs-6 mb-0">DNI</label> <input
									type="text" class="form-control" th:field="*{dni}" 
									id="InputDniCliente" placeholder="Insertar DNI 12345678">
							</div>
							<div class="mb-2">
								<label for="InputNombreCliente"
									class="form-label fw-bold fs-6 mb-0">Nombres</label> <input
									type="text" class="form-control" th:field="*{nombre}"
									id="InputNombreCliente" placeholder="Insertar nombres">
							</div>
							<div class="mb-2">
								<label for="InputApellidoCliente"
									class="form-label fw-bold fs-6 mb-0">Apellidos</label> <input
									type="text" class="form-control" th:field="*{apellido}"
									id="InputApellidoCliente" placeholder="Insertar apellidos">
							</div>
							<div class="mb-2">
								<label for="InputCorreoCliente"
									class="form-label fw-bold fs-6 mb-0">Correo</label> <input
									type="text" class="form-control" th:field="*{correo}"
									id="InputCorreoCliente" placeholder="Insertar correo">
							</div>
							<div class="mb-2">
								<label for="InputTelefonoCliente"
									class="form-label fw-bold fs-6 mb-0">Teléfono</label> <input
									type="text" pattern="^\+?[0-9\s\-]+$" class="form-control"
									th:field="*{telefono}" id="InputTelefonoCliente"
									placeholder="Insertar teléfono">
							</div>
						</div>
					</div>

					<!-- Ubicación -->
					<div>
						<h5 class="border-bottom border-2 pb-2 mb-3 text-center fw-bold">Ubicación</h5>
						<div class="ms-3 px-4">
						
						
							<input type="hidden" id="idDepartamentoSeleccionado" th:value="${ClienteEditar.id_departamento}" />
							<input type="hidden" id="idProvinciaSeleccionado" th:value="${ClienteEditar.id_provincia}" />
							<input type="hidden" id="idDistritoSeleccionado" th:value="${ClienteEditar.id_distrito}" />
							
							
							<label for="departamentosSelect" class="form-label fw-bold fs-6">Departamentos</label>
							<select id="departamentosSelect" class="form-select"
									th:field="*{id_departamento}">
								<option disabled selected value="">Seleccione una
									opción...</option>
									
							</select> <label for="provinciasSelect" class="form-label fw-bold fs-6">Provincia</label>
							<select id="provinciasSelect" class="form-select"
								th:field="*{id_provincia}">
								<option disabled selected value="">Seleccione una
									opción...</option>
							</select> <label for="distritosSelect" class="form-label fw-bold fs-6">Distrito</label>
							<select id="distritosSelect" class="form-select"
								th:field="*{id_distrito}">
								<option disabled selected value="">Seleccione una
									opción...</option>
							</select>

							<div class="mb-3">
								<label for="InputDireccionCliente"
									class="form-label fw-bold fs-6 mb-0">Dirección del
									cliente</label> <input type="text" class="form-control"
									id="InputDireccionCliente" th:field="*{direccion}"
									placeholder="Insertar dirección">
							</div>
						</div>
					</div>
				</div>

				<!-- Botones -->
				<div>
					<h5 class="border-bottom border-2 pb-2 mb-3 text-end"></h5>
					<div class="d-flex justify-content-end gap-3 mt-4">
						<a class="btn btn-outline-primary py-2 px-4 rounded-pill"
							type="button" th:href="@{/Dashboard/Clientes/ListaClientes}">Cancelar</a>
						<button type="submit"
							class="btn btn-primary py-2 px-5 rounded-pill">Guardar cambios</button>
					</div>
				</div>
			</form>
		</div>
	</div>

	<!-- Toast -->
	<div
		class="toast-container position-fixed w-100 bottom-0 start-0 p-4 mt-3 d-flex align-items-center justify-content-center">
		<div id="validationToast" class="toast text-bg-danger border-0"
			role="alert" aria-live="assertive" aria-atomic="true">
			<div class="d-flex">
				<div class="toast-body fw-bold" id="toastMessage">
					<!-- Mensaje dinámico se mostrará aquí -->
				</div>
				<button type="button" class="btn-close btn-close-white me-2 m-auto"
					data-bs-dismiss="toast" aria-label="Close"></button>
			</div>
		</div>
	</div>


	<script>
    document.getElementById('FormCliente').addEventListener('submit', function (event) {
        const dni = document.getElementById('InputDniCliente').value.trim();
        const nombre = document.getElementById('InputNombreCliente').value.trim();
        const apellido = document.getElementById('InputApellidoCliente').value.trim();
        const correo = document.getElementById('InputCorreoCliente').value.trim();
        const telefono = document.getElementById('InputTelefonoCliente').value.trim();
        const departamento = document.getElementById('departamentosSelect').value;
        const provincia = document.getElementById('provinciasSelect').value;
        const distrito = document.getElementById('distritosSelect').value;
        const direccion = document.getElementById('InputDireccionCliente').value.trim();

        function showToast(message) {
            const toastElement = document.getElementById('validationToast');
            const toastMessage = document.getElementById('toastMessage');
            toastMessage.textContent = message;
            toastElement.classList.add('show');

            setTimeout(() => {
                toastElement.classList.remove('show');
            }, 3000); // Eliminar el toast después de 3 segundos
        }

        if (!dni) {
            showToast('Por favor, ingrese el DNI del cliente.');
            event.preventDefault();
            return;
        }

        if (!nombre) {
            showToast('Por favor, ingrese el nombre del cliente.');
            event.preventDefault();
            return;
        }

        if (!apellido) {
            showToast('Por favor, ingrese el apellido del cliente.');
            event.preventDefault();
            return;
        }

        if (!correo) {
            showToast('Por favor, ingrese el correo del cliente.');
            event.preventDefault();
            return;
        }

        if (!telefono) {
            showToast('Por favor, ingrese el teléfono del cliente.');
            event.preventDefault();
            return;
        }

        if (!departamento) {
            showToast('Por favor, seleccione un departamento.');
            event.preventDefault();
            return;
        }

        if (!provincia) {
            showToast('Por favor, seleccione una provincia.');
            event.preventDefault();
            return;
        }

        if (!distrito) {
            showToast('Por favor, seleccione un distrito.');
            event.preventDefault();
            return;
        }

        if (!direccion) {
            showToast('Por favor, ingrese la dirección del cliente.');
            event.preventDefault();
            return;
        }
    });
</script>

<script>

$(document).ready(function () {
    // Obtener los departamentos
    $.get('/Ubicaciones/getDepartamentos', function (data) {
        const departamentosSelect = $('#departamentosSelect');
        departamentosSelect.empty();
        departamentosSelect.append('<option disabled selected value="">Seleccione una opción...</option>');
        
        data.forEach(function (departamento) {
            departamentosSelect.append(
                `<option value="${departamento.id}">${departamento.name}</option>`
            );
        });

        // Obtener el valor de id_departamento de Thymeleaf o de un campo oculto
        const idDepartamentoSeleccionado = $('#idDepartamentoSeleccionado').val();
        
        // Si existe un id_departamento, seleccionarlo en el select
        if (idDepartamentoSeleccionado) {
            departamentosSelect.val(idDepartamentoSeleccionado).change();

            // Cargar las provincias basadas en el departamento seleccionado
            $.get('/Ubicaciones/getProvincias', { ID: idDepartamentoSeleccionado }, function (provinciasData) {
                const provinciasSelect = $('#provinciasSelect');
                provinciasSelect.empty();
                provinciasSelect.append('<option disabled selected value="">Seleccione una opción...</option>');
                
                provinciasData.forEach(function (provincia) {
                    provinciasSelect.append(
                        `<option value="${provincia.id}">${provincia.name}</option>`
                    );
                });

                // Obtener el valor de id_provincia de Thymeleaf o de un campo oculto
                const idProvinciaSeleccionada = $('#idProvinciaSeleccionado').val();

                // Si existe un id_provincia, seleccionarlo
                if (idProvinciaSeleccionada) {
                    provinciasSelect.val(idProvinciaSeleccionada).change();

                    // Cargar los distritos basados en la provincia seleccionada
                    $.get('/Ubicaciones/getDistritos', { ID: idProvinciaSeleccionada }, function (distritosData) {
                        const distritosSelect = $('#distritosSelect');
                        distritosSelect.empty();
                        distritosSelect.append('<option disabled selected value="">Seleccione una opción...</option>');
                        
                        distritosData.forEach(function (distrito) {
                            distritosSelect.append(
                                `<option value="${distrito.id}">${distrito.name}</option>`
                            );
                        });

                        // Obtener el valor de id_distrito de Thymeleaf o de un campo oculto
                        const idDistritoSeleccionado = $('#idDistritoSeleccionado').val();

                        // Si existe un id_distrito, seleccionarlo
                        if (idDistritoSeleccionado) {
                            distritosSelect.val(idDistritoSeleccionado);
                        }
                    }).fail(function () {
                        alert('Error al cargar los distritos.');
                    });
                }
            }).fail(function () {
                alert('Error al cargar las provincias.');
            });
        }
    }).fail(function () {
        alert('Error al cargar los departamentos.');
    });

    // Actualizar las provincias al seleccionar un departamento
    $('#departamentosSelect').change(function () {
        const departamentoId = $(this).val(); // Obtener el ID del departamento seleccionado

        if (departamentoId) {
            $.get('/Ubicaciones/getProvincias', { ID: departamentoId }, function (data) {
                const provinciasSelect = $('#provinciasSelect');
                provinciasSelect.empty();
                provinciasSelect.append('<option disabled selected value="">Seleccione una opción...</option>');
                data.forEach(function (provincia) {
                    provinciasSelect.append(
                        `<option value="${provincia.id}">${provincia.name}</option>`
                    );
                });

                // Reiniciar el select de distritos cuando cambie el departamento
                $('#distritosSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
            }).fail(function () {
                alert('Error al cargar las provincias.');
            });
        } else {
            // Reiniciar provincias y distritos si no hay selección
            $('#provinciasSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
            $('#distritosSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
        }
    });

    // Actualizar los distritos al seleccionar una provincia
    $('#provinciasSelect').change(function () {
        const provinciaId = $(this).val(); // Obtener el ID de la provincia seleccionada

        if (provinciaId) {
            $.get('/Ubicaciones/getDistritos', { ID: provinciaId }, function (data) {
                const distritosSelect = $('#distritosSelect');
                distritosSelect.empty();
                distritosSelect.append('<option disabled selected value="">Seleccione una opción...</option>');
                data.forEach(function (distrito) {
                    distritosSelect.append(
                        `<option value="${distrito.id}">${distrito.name}</option>`
                    );
                });
            }).fail(function () {
                alert('Error al cargar los distritos.');
            });
        } else {
            // Reiniciar distritos si no hay selección
            $('#distritosSelect').empty().append('<option disabled selected value="">Seleccione una opción...</option>');
        }
    });
});


</script>

	<script>
        setActiveByIndex(0);
    </script>
</body>

</html>
